<!DOCTYPE html>
<html style="display: block; height: 4154px">

  <body>
    <div style="display: block; width: 1000px; margin-left: auto; margin-right: auto;" id="plots">

      <canvas id="canvas_correct"></canvas>
      <canvas id="canvas_others"></canvas>
      <canvas id="canvas_detected"></canvas>
      <canvas id="canvas_falsepositive"></canvas>
      <canvas id="canvas_smart_cables_connection"></canvas>
      <canvas id="canvas_smart_cables_connection_per_appliance"></canvas>

      <canvas id="canvas_correctness_by_meter_washing_machine"></canvas>
      <canvas id="canvas_correctness_by_meter_dishwasher"></canvas>
      <canvas id="canvas_correctness_by_meter_fridge"></canvas>
      <canvas id="canvas_correctness_by_meter_tumble_dryer"></canvas>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script type="text/javascript">

      function Color(red, green, blue, alpha) {
        this.red = red;
        this.green = green;
        this.blue = blue; 
        this.alpha = alpha;
        this.toString = () => `rgb(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`;
      }

      const blue = new Color(66, 133, 244, 1);
      const yellow = new Color(244, 180, 0, 1);
      const green = new Color(15, 157, 88, 1);
      const purple = new Color(171, 71, 188, 1);
      const red = new Color(219, 68, 55, 1);
      const lightRed = new Color(219, 68, 55, 0.12);

      printCorrectCanvas();
      printOthersCanvas();
      printDetectedCanvas();
      printFalsePositiveCanvas();

      //printSmartCablesConnection();
      //printSmartCablesPerApplianceConnection();

      printCorrectnessByMeterWashingMachine();
      printCorrectnessByMeterDishwasher();
      printCorrectnessByMeterFridge();
      printCorrectnessByMeterTumbleDryer();

      updateIframeHeight();





/*---------------- KIPs overviews ----------------*/

      function printCorrectCanvas()
      {
        var labels = ['29/04/2020', '06/05/2020', '13/05/2020', '20/05/2020'];

        // Label[0],            Fill[1],    Color/BorderColor[2],   BackgroundColor[3],   Data[4]
        var dataAppliances = [
          ['Dishwasher',        false,      blue,                   null,                 [30, 44, 56, 61] ],
          ['Tumble Dryer',      false,      yellow,                 null,                 [45, 41, 60, 61] ],
          ['Washing Machine',   false,      green,                  null,                 [86, 80, 84, 85] ],
          ['Fridge',            false,      purple,                 null,                 [45, 60, 62, 80] ],
          ['Objetive',          true,       red,                    lightRed,             [80, 80, 80, 80] ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForLineCharts(dataAppliances)
        }

        CreateLineChart('canvas_correct', 'Correct Energy', data);

      }

      function printOthersCanvas()
      {
        var labels = ['29/04/2020', '06/05/2020', '13/05/2020', '20/05/2020'];

        // Label[0],            Fill[1],    Color/BorderColor[2],   BackgroundColor[3],   Data[4]
        var dataAppliances = [
          ['Others',            false,      blue,                   blue,                 [77, 64, 85, 86] ],
          ['Objetive',          true,       red,                    lightRed,             [80, 80, 80, 80] ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForLineCharts(dataAppliances)
        }

        CreateLineChart('canvas_others', 'Percentage of days with Others <20%', data);
      }

      function printDetectedCanvas()
      {
        var labels = ['29/04/2020', '06/05/2020', '13/05/2020', '20/05/2020'];

        // Label[0],            Fill[1],    Color/BorderColor[2],   BackgroundColor[3],   Data[4]
        var dataAppliances = [
          ['Dishwasher',        false,      blue,                   blue,                 [45, 64, 69, 60] ],
          ['Tumble Dryer',      false,      yellow,                 yellow,               [49, 44, 45, 45] ],
          ['Washing Machine',   false,      green,                  green,                [80, 78, 81, 82] ],
          ['Objetive',          true,       red,                    lightRed,             [80, 80, 80, 80] ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForLineCharts(dataAppliances)
        }

        CreateLineChart('canvas_detected', 'Detected Cycles', data);
      }

      function printFalsePositiveCanvas()
      {
        var labels = ['29/04/2020', '06/05/2020', '13/05/2020', '20/05/2020'];

        // Label[0],            Fill[1],    Color/BorderColor[2],   BackgroundColor[3],   Data[4]
        var dataAppliances = [
          ['Dishwasher',        false,      blue,                   blue,                 [2, 21, 16, 7]    ],
          ['Tumble Dryer',      false,      yellow,                 yellow,               [4, 4, 5, 6]      ],
          ['Washing Machine',   false,      green,                  green,                [13, 12, 16, 17]  ],
          ['Objetive',          'end',      red,                    lightRed,             [10, 10, 10, 10]  ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForLineCharts(dataAppliances)
        }

        CreateLineChart('canvas_falsepositive', 'False Positive Cycles', data);
      }

      function printSmartCablesConnection()
      {
        var ctx = document.getElementById('canvas_smart_cables_connection');

        var data =  {
          labels: ['08/04/2020', '15/04/2020', '22/04/2020', '29/04/2020', '06/05/2020', '13/05/2020'],
          datasets: [
            {
              label: 'Connection',
              fill: false,
              pointHoverRadius: 6,
              borderWidth: 2,
              lineTension: 0,
              selected: false,
              color: blue,
              borderColor: blue.toString(),
              backgroundColor: blue.toString(),
              data: [43, 66, 93, 91, 94, 94]
            }
          ]
        }

        var options = {
          title: {
              display: true,
              text: 'Smart Cables Connection',
              fontSize: 30,
              fontStyle: 'bold',
              fontColor: '#000',
              lineHeight: 3
          },
          legend: {
            position: 'right',
            align: 'start',
            onClick: function (event, legendItem) {
              onClickLegendItem(event, legendItem, myLineChart)
            },
            onHover: function (event, legendItem) {
              onHoverLegendItem(event, legendItem, myLineChart)
            },
            onLeave: function (event, legendItem) {
              onLeaveLegendItem(event, legendItem, myLineChart)
            }
          },
          scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true 
                }
            }]
          },
          hover: {
						mode: 'point',
						intersect: false,
					}
        };
        
        var myLineChart = new Chart(ctx, {
          type: 'line',
          data: data,
          options: options
        });
      }

      function printSmartCablesPerApplianceConnection()
      {
        var ctx = document.getElementById('canvas_smart_cables_connection_per_appliance');

        var data =  {
          labels: ['08/04/2020', '15/04/2020', '22/04/2020', '29/04/2020', '06/05/2020', '13/05/2020'],
          datasets: [
            {
              label: 'Dishwasher',
              fill: false,
              pointHoverRadius: 6,
              borderWidth: 2,
              lineTension: 0,
              selected: false,
              color: blue,
              borderColor: blue.toString(),
              backgroundColor: blue.toString(),
              data: [9, 14, 14, 19, 19, 21]
            },
            {
              label: 'Tumble Dryer',
              fill: false,
              pointHoverRadius: 6,
              borderWidth: 2,
              lineTension: 0,
              selected: false,
              color: yellow,
              borderColor: yellow.toString(),
              backgroundColor: yellow.toString(),
              data: [17, 28, 27, 27, 28, 28]
            },
            {
              label: 'Washing Machine',
              fill: false,
              pointHoverRadius: 6,
              borderWidth: 2,
              lineTension: 0,
              selected: false,
              color: green,
              borderColor: green.toString(),
              backgroundColor: green.toString(),
              data: [12, 25, 33, 43, 44, 60]
            },
            {
              label: 'Fridge',
              fill: false,
              pointHoverRadius: 6,
              borderWidth: 2,
              lineTension: 0,
              selected: false,
              color: purple,
              borderColor: purple.toString(),
              backgroundColor: purple.toString(),
              data: [13, 25, 34, 46, 49, 49]
            }
          ]
        }

        var options = {
          title: {
              display: true,
              text: 'Smart Cables Connection Per Appliance',
              fontSize: 30,
              fontStyle: 'bold',
              fontColor: '#000',
              lineHeight: 3
          },
          legend: {
            position: 'right',
            align: 'start',
            onClick: function (event, legendItem) {
              onClickLegendItem(event, legendItem, myLineChart)
            },
            onHover: function (event, legendItem) {
              onHoverLegendItem(event, legendItem, myLineChart)
            },
            onLeave: function (event, legendItem) {
              onLeaveLegendItem(event, legendItem, myLineChart)
            }
          },
          scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
          },
          hover: {
						mode: 'point',
						intersect: false,
					}
        };
        
        var myLineChart = new Chart(ctx, {
          type: 'line',
          data: data,
          options: options
        });
      }





/*---------------- Correctness By Meter Per Appliance ----------------*/

      /* Washing Machine */
      function printCorrectnessByMeterWashingMachine()
      {
        var labels = ['fef3', '78f9', 'fda4', 'da77', 'c72f', '237e', '56d6', '4ec4', 'f4a6'];

        // Label[0],                      Type[1],      yAxisID[2],                               BorderColor[3],   BackgroundColor[4],   Data[5]
        var data = [
          ['Percentage Correct Days',     'bar',        'y-axis-prctg-correct-days-objective',    blue,             blue,                 [58.82, 63.63, 66.66, 83.33, 85.71, 88.46, 91.30, 100, 100] ],
          ['Number of Days',              'bar',        'y-axis-number-days',                     yellow,           yellow,               [17, 11, 3, 18, 42, 26, 46, 1, 25] ],
          ['Objetive',                    'line',       'y-axis-prctg-correct-days-objective',    red,              lightRed,             [80, 80, 80, 80, 80, 80, 80, 80, 80] ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForBarCharts(data)
        }

        CreateBarChart('canvas_correctness_by_meter_washing_machine', 'Washing Machine', data );
      }

      /* Dishwasher */
      function printCorrectnessByMeterDishwasher()
      {
        var labels = ['ac33', 'bffa', '237e', 'fef3', 'f4a6'];

        // Label[0],                      Type[1],      yAxisID[2],                               Color/BorderColor[3],   BackgroundColor[4],   Data[5]
        var data = [
          ['Percentage Correct Days',     'bar',        'y-axis-prctg-correct-days-objective',    blue,                   blue,                 [25, 34.78, 57.89, 84.61, 87.5] ],
          ['Number of Days',              'bar',        'y-axis-number-days',                     yellow,                 yellow,               [4, 46, 19, 26, 24] ],
          ['Objetive',                    'line',       'y-axis-prctg-correct-days-objective',    red,                    lightRed,             [80, 80, 80, 80, 80] ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForBarCharts(data)
        }

        CreateBarChart('canvas_correctness_by_meter_dishwasher', 'Dishwasher', data );
      }

      /* Meter Fridge */
      function printCorrectnessByMeterFridge()
      {
        var labels = ['56d6', '78f9', 'b3e9', '4473', 'f4a6', '4ec4'];

        // Label[0],                      Type[1],      yAxisID[2],                               Color/BorderColor[3],   BackgroundColor[4],   Data[5]
        var data = [
          ['Percentage Correct Days',     'bar',        'y-axis-prctg-correct-days-objective',    blue,                   blue,                 [43.75, 76.66, 88.63, 90, 100, 100] ],
          ['Number of Days',              'bar',        'y-axis-number-days',                     yellow,                 yellow,               [32, 30, 44, 30, 25, 1] ],
          ['Objetive',                    'line',       'y-axis-prctg-correct-days-objective',    red,                    lightRed,             [80, 80, 80, 80, 80, 80] ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForBarCharts(data)
        }

        CreateBarChart('canvas_correctness_by_meter_fridge', 'Fridge', data);
      }

      /* Tumble Dryer */
      function printCorrectnessByMeterTumbleDryer()
      {
        var labels = ['b3e9', '237e', 'fef3', '8575'];

        // Label[0],                      Type[1],      yAxisID[2],                               Color/BorderColor[3],   BackgroundColor[4],   Data[5]
        var data = [
          ['Percentage Correct Days',     'bar',        'y-axis-prctg-correct-days-objective',    blue,                   blue,                 [18.18, 47.72, 80.43, 97.87] ],
          ['Number of Days',              'bar',        'y-axis-number-days',                     yellow,                 yellow,               [44, 44, 46, 47] ],
          ['Objetive',                    'line',       'y-axis-prctg-correct-days-objective',    red,                    lightRed,             [80, 80, 80, 80] ],
        ];

        var data =  {
          labels: labels,
          datasets: CreateDataSetArrayForBarCharts(data)
        }

        CreateBarChart('canvas_correctness_by_meter_tumble_dryer', 'Tumble Dryer', data);
      }




/*---------------- Create Charts ----------------*/

      function CreateLineChart(elementId, title, data)
      {
        var ctx = document.getElementById(elementId).getContext('2d');

        var options = {
          title: {
              display: true,
              text: title,
              fontSize: 30,
              fontStyle: 'bold',
              fontColor: '#000',
              lineHeight: 3
          },
          legend: {
            position: 'right',
            align: 'start',
            labels: {
              fontStyle: 'normal',
              strokeStyle: 'rgb(0, 255, 0)'
            },
            onClick: function (event, legendItem) {
              onClickLegendItem(event, legendItem, myLineChart)
            },
            onHover: function (event, legendItem) {
              onHoverLegendItem(event, legendItem, myLineChart)
            },
            onLeave: function (event, legendItem) {
              onLeaveLegendItem(event, legendItem, myLineChart)
            }
          },
          scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true,
                    max: 100
                }
            }]
          },
          hover: {
						mode: 'point',
						intersect: false,
					}
        };
        
        var myLineChart = new Chart(ctx, {
          type: 'line',
          data: data,
          options: options
        });

      }

      function CreateBarChart(elementId, title, data)
      {
        var ctx = document.getElementById(elementId);

        var options = {
          title: {
              display: true,
              text: title,
              fontSize: 30,
              fontStyle: 'bold',
              fontColor: '#000',
              lineHeight: 3
          },
          legend: {
            position: 'right',
            align: 'start',
            labels: {
              //fontStyle: 'bolder'
              fontWeight: 500
            },
            onClick: function (event, legendItem) {
              onClickLegendItem(event, legendItem, myBarChart)
            },
            onHover: function (event, legendItem) {
              onHoverLegendItem(event, legendItem, myBarChart)
            },
            onLeave: function (event, legendItem) {
              onLeaveLegendItem(event, legendItem, myBarChart)
            }
          },
          scales: {
            yAxes: [
              {
                ticks: {
                    beginAtZero: true,
                    max: 100
                },
                display: true,
                position: 'left',
                id: 'y-axis-prctg-correct-days-objective'
              },
              {
                ticks: {
                    beginAtZero: true,
                    max: 50
                },
                display: true,
                position: 'right',
                id: 'y-axis-number-days'
              }
            ]
          },
          hover: {
						mode: 'point',
						intersect: false,
					}
        };
        
        var myBarChart = new Chart(ctx, {
          type: 'bar',
          data: data,
          options: options
        });
      }




/*---------------- Create DataSet Array ----------------*/

      function CreateDataSetArrayForLineCharts(options)
      {
        var dataSets = [];

        for (let i = 0; i < options.length; i++) {

          var dataSet = {
            pointHoverRadius: 6,
            borderWidth: 2,
            lineTension: 0,
            selected: false,
            label: options[i][0],
            fill: options[i][1],
            color: options[i][2],
            borderColor: options[i][2].toString(),
            colorBackground: options[i][3],
            backgroundColor: options[i][3] ? options[i][3].toString() : null,
            data: options[i][4]
          };

          dataSets.push(dataSet);
        }

        return dataSets;
      }

      function CreateDataSetArrayForBarCharts(options)
      {
        var dataSets = [];

        for (let i = 0; i < options.length; i++) {

          var dataSet = {
            borderWidth: 2,
            lineTension: 0,
            pointHoverRadius: 6,
            selected: false,
            label: options[i][0],
            type: options[i][1],
            yAxisID: options[i][2],

            color: options[i][3],
            borderColor: options[i][1] == 'line' ? options[i][3].toString() : null,

            colorBackground: options[i][1] == 'line' ? options[i][4] : null,
            backgroundColor: options[i][4].toString(),

            data: options[i][5]
          };

          dataSets.push(dataSet);
        }

        return dataSets;
      }





/*---------------- Update iframe height ----------------*/

      function updateIframeHeight() {

        var plots = document.getElementById('plots');
        var plotsStyle = getComputedStyle(plots);

        console.log('Plot Height: ' + plotsStyle.height);

        /*
        var iFrameID = window.parent.document.getElementById('iframe_plots');

        if(iFrameID) {

          console.log('iframe');

          console.log('IFrame Height: ' + iFrameID.height);

          iFrameID.height = "";
          iFrameID.height = plotsStyle.height;
        }*/
      }





/*---------------- Improvements on Charts behaviours ----------------*/

      function onHoverLegendItem(event, legendItem, chart)
      {
        var index = legendItem.datasetIndex;
        var dataSet = chart.data.datasets[index];
        var ds = chart.getDatasetMeta(index);

        if(dataSet.barPercentage != null)
        {
          dataSet.barPercentage = 1;
        }
        else if(dataSet.borderWidth != null)
        {
          dataSet.borderWidth = 6;
        }

        chart.update();
      }

      function onLeaveLegendItem(event, legendItem, chart)
      {
        var index = legendItem.datasetIndex;
        var dataSet = chart.data.datasets[index];

        if(!dataSet.selected)
        {
          if(dataSet.barPercentage != null)
          {
            dataSet.barPercentage = 0.8;
          }
          else if(dataSet.borderWidth != null)
          {
            dataSet.borderWidth = 2;
          }
        } 

        chart.update();
      }

      function onClickLegendItem(event, legendItem, chart)
      {
        var index = legendItem.datasetIndex;
        var dataSet = chart.getDatasetMeta(index);
        var dataSetSelected = dataSet.controller._config.selected;

        for (let i = 0; i < chart.data.datasets.length; i++) {

          var colorAlpha = 1;
          var colorBackgroundAlpha = 0.12;
          var borderWidth = 2;
          var selected = false;

          var color = chart.data.datasets[i].color;
          var colorBackground = chart.data.datasets[i].colorBackground;

          if(dataSetSelected)
          {
            colorAlpha = 1;
            colorBackgroundAlpha = 0.12;
            borderWidth = 2;
            selected = false;

            //HideTooltipsOfSelectedDataSet(chart, dataSet);
          }
          else
          {
            if(index == i)
            {
              colorAlpha = 1;
              colorBackgroundAlpha = 0.12;
              borderWidth = 6;
              selected = true;

              //ShowTooltipsOfSelectedDataSet(chart, dataSet);
            } 
            else
            {
              colorAlpha = 0.2;
              colorBackgroundAlpha = 0.05;
              borderWidth = 2;
              selected = false;
            }
          }

          chart.data.datasets[i].selected = selected;
          chart.data.datasets[i].borderWidth = borderWidth;

          color.alpha = colorAlpha;
          chart.data.datasets[i].color = color;
          chart.data.datasets[i].borderColor = color.toString();

          if(colorBackground == null)
          {
            chart.data.datasets[i].backgroundColor = color.toString();
          }
          else
          {
            colorBackground.alpha = colorBackgroundAlpha;
            chart.data.datasets[i].colorBackground = colorBackground;
            chart.data.datasets[i].backgroundColor = colorBackground.toString();
          }
        }

        chart.update();
      }

      function ShowTooltipsOfSelectedDataSet(chart, dataSet)
      {
        if(chart.tooltip._active == undefined)
          chart.tooltip._active = [];

        for (let i = 0; i < dataSet.data.length; i++) {

          console.log(dataSet.data[i]);


          chart.tooltip._active.push(dataSet.data[i]);
        }

        chart.tooltip.update(true);
      }

      function HideTooltipsOfSelectedDataSet(chart, dataSet)
      {
        var activeElements = chart.tooltip._active;

        if(chart.tooltip._active == undefined || chart.tooltip._active.length == 0)
        {
          return;
        }

        var requestedElem = chart.getDatasetMeta(datasetIndex).data[pointIndex];
        for(var i = 0; i < activeElements.length; i++) {
            if(requestedElem._index == activeElements[i]._index)  {
                activeElements.splice(i, 1);
                break;
            }
        }
        chart.tooltip._active = activeElements;
        chart.tooltip.update(true);
        chart.draw();
      }

    </script>

  </body>

</html>
